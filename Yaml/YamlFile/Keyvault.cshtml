@model Yaml.Infrastructure.Dto.YamlAppInfoDto
apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: @Model.AppName-keyvault-spc
  namespace: @Model.AppName-ns
spec:
  parameters:
    keyvaultName: @Model.KeyVault?.KeyVaultName
    objects: |
      array:
        @foreach (var kv in @Model.KeyVault.KeyVault)
        {
          string obj = $"        - | \n" +
                       $"          objectType: secret \n" +
                       $"          objectName: {kv.ConfigKey} \n";
          @obj
        }
    tenantId: @Model.KeyVault?.TenantId
    usePodIdentity: "true"
    useVMManagedIdentity: "false"
    userAssignedIdentityID: @Model.KeyVault?.ManagedId
  provider: azure
  secretObjects:
  - data:
      @foreach (var kv in Model.KeyVault.KeyVault)
      {
        string sc = $"      - key: {kv.ConfigKey} \n" +
                    $"        objectName: {kv.ConfigKey} \n";
        @sc
      }
    secretName: @Model.AppName-secret
    type: Opaque